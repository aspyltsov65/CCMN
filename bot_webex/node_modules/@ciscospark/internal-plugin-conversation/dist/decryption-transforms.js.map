{"version":3,"sources":["decryption-transforms.js"],"names":["decryptTextProp","name","ctx","key","object","transform","transforms","decryptObject","undefined","resolve","objectType","encryptionKeyUrl","all","files","items","map","item","decryptConversation","conversation","promises","activities","push","usableKey","decryptionFailureMessage","spark","internal","config","catch","error","logger","warn","url","avatarEncryptionKeyUrl","avatar","decryptActivity","activity","keyUrl","decryptMicroappinstance","microappInstance","decryptComment","comment","decryptContent","content","contentCategory","decryptContentFiles","Array","isArray","links","forEach","decryptContentLinks","decryptEvent","event","location","split","length","decryptFile","file","transcodedCollection","image","decryptLink","link","decryptTranscodedContent","transcodedContent","decryptImageURI","imageURI","encryption","decryptText","then","plaintext","keepEncryptedProperties","encryptedPropName","reason","decryptPropScr","decryptScr","scr","decryptPropSslr","sslr","decryptPropDisplayName","decryptPropContent","decryptPropModel","decryptPropLocation"],"mappings":"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","file":"decryption-transforms.js","sourcesContent":["/*!\n * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {camelCase, capitalize, curry} from 'lodash';\n\nimport toArray from './to-array';\n\nconst decryptTextProp = curry((name, ctx, key, object) => ctx.transform('decryptTextProp', name, key, object));\n\n// eslint-disable-next-line import/prefer-default-export\nexport const transforms = toArray('inbound', {\n\n  /**\n   * This function is used recursively to decrypt various properties on convesations, activities, etc\n   * @param   {Object} ctx    An object containg a spark instance and a transform\n   * @param   {String} key    KMS encryption key url\n   * @param   {Object} object Generic object that you want to decrypt some property on based on the type\n   * @returns {Promise}       Returns a transform promise\n   */\n  decryptObject(ctx, key, object) {\n    if (!object) {\n      object = key; // eslint-disable-line no-param-reassign\n      key = undefined; // eslint-disable-line no-param-reassign\n    }\n\n    if (!object) {\n      return Promise.resolve();\n    }\n\n    if (!object.objectType) {\n      return Promise.resolve();\n    }\n\n    if (!key && object.encryptionKeyUrl) {\n      key = object.encryptionKeyUrl; // eslint-disable-line no-param-reassign\n    }\n\n    // Transcoded content was not showing up on the activities since the\n    // decryptFile was not being called. Calling decryptFile for\n    // transcodedContent fixes the issue.\n    if (object.objectType === 'transcodedContent') {\n      return Promise.all(object.files.items.map((item) => ctx.transform('decryptFile', key, item)));\n    }\n\n    return ctx.transform(`decrypt${capitalize(object.objectType)}`, key, object);\n  },\n\n  /**\n   * Decrypts a given conversation and it's activites by building an array of promises that call\n   * decryptObject, which may then call other decrypt functions\n   *\n   * @param   {Object} ctx          An object containg a spark instance and a transform\n   * @param   {String} key          KMS encryption key url (or actual key?)\n   * @param   {Object} conversation A Webex Teams conversation object\n   * @returns {Promise}             Returns the result of Promise.all\n   */\n  decryptConversation(ctx, key, conversation) {\n    const promises = [];\n\n    if (conversation.activities.items) {\n      promises.push(Promise.all(conversation.activities.items.map((item) => ctx.transform('decryptObject', null, item))));\n    }\n\n    const usableKey = conversation.encryptionKeyUrl || key;\n    const {decryptionFailureMessage} = ctx.spark.internal.conversation.config;\n\n    if (usableKey) {\n      promises.push(ctx.transform('decryptPropDisplayName', usableKey, conversation)\n        .catch((error) => {\n          ctx.spark.logger.warn('plugin-conversation: failed to decrypt display name of ', conversation.url, error);\n          Promise.resolve(decryptionFailureMessage);\n        }));\n      promises.push(ctx.transform('decryptPropContent', usableKey, conversation));\n    }\n    if (conversation.avatarEncryptionKeyUrl) {\n      promises.push(ctx.transform('decryptObject', conversation.avatarEncryptionKeyUrl, conversation.avatar));\n    }\n\n    return Promise.all(promises);\n  },\n\n  /**\n   * Decrypt an individual activity\n   * @param   {Object} ctx      An object containg a spark instance and a transform\n   * @param   {String} key      KMS encryption key url (or actual key?)\n   * @param   {Object} activity An instance of a Webex Teams activity\n   * @returns {Promise}         Returns a ctx.transform promise\n   */\n  decryptActivity(ctx, key, activity) {\n    if (!activity.encryptionKeyUrl && !(activity.object && activity.object.encryptionKeyUrl)) {\n      return Promise.resolve(activity);\n    }\n\n    const keyUrl = activity.encryptionKeyUrl || activity.object.encryptionKeyUrl || key;\n\n    return ctx.transform('decryptObject', keyUrl, activity.object);\n  },\n\n  /**\n   * Decrypts a microappInstance (recording) model\n   * @param   {Object} ctx                     An object containing a spark instance and transform prop\n   * @param   {String} key                     KMS key\n   * @param   {Object} microappInstance        A microappInstance which includes several properties of a recording\n   * @param   {String} microappInstance.model  An encrypted string which decrypts to an object\n   * @returns {Promise}                        Returns a contex transform\n   */\n  decryptMicroappinstance(ctx, key, microappInstance) {\n    return ctx.transform('decryptPropModel', key, microappInstance);\n  },\n\n  /**\n   * Decrypts a comment...\n   * @param   {Object} ctx     An object containing a spark instance and transform prop\n   * @param   {String} key     KMS key\n   * @param   {Object} comment A comment object with a displayName and content (encrypted)\n   * @returns {Promise}        Returns the results of Promise.all on two transforms\n   */\n  decryptComment(ctx, key, comment) {\n    return Promise.all([\n      ctx.transform('decryptPropDisplayName', key, comment),\n      ctx.transform('decryptPropContent', key, comment)\n    ]);\n  },\n\n  /**\n   * Decrypts a content field\n   * @param   {Object} ctx            An object containing a spark instance and transform prop\n   * @param   {String} key            KMS key\n   * @param   {Object} content        An object with properties to be decrypted\n   * @returns {Promise}               A promise that will return when the decryption has finished\n   */\n  decryptContent(ctx, key, content) {\n    if (content.contentCategory === 'links') {\n      return ctx.transform('decryptContentLinks', key, content);\n    }\n\n    return ctx.transform('decryptContentFiles', key, content);\n  },\n\n  /**\n   * Decrypts a content field which contains files and possibly links\n   * @param   {Object} ctx            An object containing a spark instance and transform prop\n   * @param   {String} key            KMS key\n   * @param   {Object} content        An object with properties to be decrypted\n   * @param   {Array}  content.files  An array of files to decrypt by calling decryptObject\n   * @param   {Array}  content.links  An array of links to decrypt by calling decryptObject\n   * @returns {Promise}               A promise that will return when the decryption has finished\n   */\n  decryptContentFiles(ctx, key, content) {\n    if (!content.files || !content.files.items || !Array.isArray(content.files.items)) {\n      return Promise.resolve();\n    }\n\n    const promises = content.files.items.map((item) => ctx.transform('decryptObject', key, item));\n\n    promises.push(ctx.transform('decryptComment', key, content));\n\n    if (content.links && content.links.items && Array.isArray(content.links.items)) {\n      content.links.items.forEach((item) => promises.push(ctx.transform('decryptObject', key, item)));\n    }\n\n    return Promise.all(promises);\n  },\n\n  /**\n   * Decrypts a content field which contains links\n   * @param   {Object} ctx            An object containing a spark instance and transform prop\n   * @param   {String} key            KMS key\n   * @param   {Object} content        An object with properties to be decrypted\n   * @param   {Array}  content.links  An array of links to decrypt by calling decryptObject\n   * @returns {Promise}               A promise that will return when the decryption has finished\n   */\n  decryptContentLinks(ctx, key, content) {\n    if (!content.links || !content.links.items || !Array.isArray(content.links.items)) {\n      return Promise.resolve();\n    }\n\n    const promises = content.links.items.map((item) => ctx.transform('decryptObject', key, item));\n\n    promises.push(ctx.transform('decryptComment', key, content));\n\n    return Promise.all(promises);\n  },\n\n  /**\n   * Decrypts what may be a meeting event?\n   * @param   {Object} ctx   An object containing a spark instance and transform prop\n   * @param   {String} key   KMS key\n   * @param   {Object} event An object with a display name and location to be decrypted\n   * @returns {Promise}      Returns the result of Promise.all\n   */\n  decryptEvent(ctx, key, event) {\n    const promises = [\n      ctx.transform('decryptPropDisplayName', key, event)\n    ];\n\n    if (event.location && event.location.split('.').length === 5) {\n      promises.push(ctx.transform('decryptPropLocation', key, event));\n    }\n\n    return Promise.all(promises);\n  },\n\n  /**\n   * Decrypts a file and it's transcodedContents if they exist\n   * @param   {Object} ctx  An object containing a spark instance and transform prop\n   * @param   {String} key  KMS key\n   * @param   {Object} file A file object with file props an optional transcodedCollection to decrypt\n   * @returns {Promise}     Returns the result of Promise.all\n   */\n  decryptFile(ctx, key, file) {\n    return Promise.all([\n      file.transcodedCollection && Promise.all(file.transcodedCollection.items.map((item) => ctx.transform('decryptObject', key, item))),\n      ctx.transform('decryptPropScr', key, file),\n      ctx.transform('decryptPropDisplayName', key, file),\n      ctx.transform('decryptPropContent', key, file),\n      file.image && ctx.transform('decryptPropScr', key, file.image)\n    ]);\n  },\n\n  /**\n   * Decrypts a file and it's transcodedContents if they exist\n   * @param   {Object} ctx  An object containing a spark instance and transform prop\n   * @param   {String} key  KMS key\n   * @param   {Object} link A link object with a URL to decrypt\n   * @returns {Promise}     Returns the result of Promise.all\n   */\n  decryptLink(ctx, key, link) {\n    return Promise.all([\n      ctx.transform('decryptPropSslr', key, link),\n      ctx.transform('decryptPropDisplayName', key, link)\n    ]);\n  },\n\n  /**\n   * Decrypts transcoded file content. Calls decryptFile\n   * @param   {Object} ctx               An object containing a spark instance and transform prop\n   * @param   {String} key               KMS key\n   * @param   {Object} transcodedContent Transcoded content with a files prop\n   * @returns {Promise}                  Returns the result of Promise.all\n   */\n  decryptTranscodedContent(ctx, key, transcodedContent) {\n    return Promise.all(transcodedContent.files.items.map((item) => ctx.transform('decryptFile', key, item)));\n  },\n\n  /**\n   * Decrypts an image uri\n   * @param   {Object} ctx       An object containing a spark instance and transform prop\n   * @param   {String} key       KMS key\n   * @param   {String} imageURI  URI of the image to decrypt\n   * @returns {Promise}          Returns a promise.\n   */\n  decryptImageURI(ctx, key, imageURI) {\n    return ctx.transform('decryptPropLocation', key, imageURI);\n  },\n\n  /**\n   * The heart of most decryption logic ends here. Decrypting text.\n   * @param   {Object} ctx    An object containing a spark instance and transform prop\n   * @param   {String} name   Property of an object to be decrypted\n   * @param   {String} key    KMS key\n   * @param   {Object} object A generic object with text props to be decrypted\n   * @returns {Promise}       Returns a lonely Promise\n   */\n  decryptTextProp(ctx, name, key, object) {\n    if (!object[name]) {\n      return Promise.resolve();\n    }\n    const {decryptionFailureMessage} = ctx.spark.internal.conversation.config;\n\n    return ctx.spark.internal.encryption.decryptText(key, object[name])\n      .then((plaintext) => {\n        if (ctx.spark.config.conversation.keepEncryptedProperties) {\n          const encryptedPropName = camelCase(`encrypted_${name}`);\n\n          object[encryptedPropName] = object[name]; // eslint-disable-line no-param-reassign\n        }\n\n        object[name] = plaintext; // eslint-disable-line no-param-reassign\n      })\n      .catch((reason) => {\n        ctx.spark.logger.warn(`plugin-conversation: failed to decrypt ${name} `, reason);\n        object[name] = decryptionFailureMessage; // eslint-disable-line no-param-reassign\n\n        return Promise.resolve(decryptionFailureMessage);\n      });\n  },\n\n  /**\n   * Decrypts the src of an object (for images?)\n   * @param   {Object} ctx    An object containing a spark instance and transform prop\n   * @param   {String} key    KMS key\n   * @param   {Object} object An object with a scr property to be decrypted\n   * @returns {Promise}       Returns a promise\n   */\n  decryptPropScr(ctx, key, object) {\n    return ctx.spark.internal.encryption.decryptScr(key, object.scr)\n      .then((scr) => {\n        object.scr = scr; // eslint-disable-line no-param-reassign\n      });\n  },\n\n  /**\n   * Decrypts the sslr object\n   * @param   {Object} ctx    An object containing a spark instance and transform prop\n   * @param   {String} key    KMS key\n   * @param   {Object} object An object with a sslr property to be decrypted\n   * @returns {Promise}       Returns a promise\n   */\n  decryptPropSslr(ctx, key, object) {\n    return ctx.spark.internal.encryption.decryptScr(key, object.sslr)\n      .then((sslr) => {\n        object.sslr = sslr; // eslint-disable-line no-param-reassign\n      });\n  },\n\n  decryptPropDisplayName: decryptTextProp('displayName'),\n\n  decryptPropContent: decryptTextProp('content'),\n\n  decryptPropModel: decryptTextProp('model'),\n\n  decryptPropLocation: decryptTextProp('location')\n});\n"]}